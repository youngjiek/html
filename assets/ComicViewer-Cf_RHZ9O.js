import{_ as R,b as g,d as V,w as F,e as S,c as r,a as s,f as T,v as j,g as $,F as y,r as A,h as q,o as i}from"./index-B4to0h6c.js";const J=async(m,n)=>{console.log(`🚀 开始加载 ${n} 张图片, 初始 URL: ${m}`);let o=[],v=m,a=0;for(let c=1;c<=n;c++){if(a>=3){console.log("❌ 失败次数达到 3 次，停止加载");break}const u=await I(v,1);u?(console.log(`✅ 加载成功: ${u}`),o.push(u),v=u,a=0):(console.log(`⚠️ 加载失败 (第 ${a+1} 次)`),a++)}return o.length===0&&alert("❌ 无法加载更多图片，请检查是否结束！"),console.log(`🎉 加载完成, 成功加载 ${o.length} 张图片:`,o),o},I=async(m,n)=>{console.log("🔍 原始 URL:",m);const o=m.match(/\/([^\/]+)\.([a-zA-Z0-9]+)$/);if(!o)return console.log("❌ 无法解析 URL 文件名"),null;let v=o[1],a=o[2].toLowerCase();const c=m.replace(o[0],"/");console.log("📌 解析出的文件名:",v),console.log("📌 解析出的扩展名:",a),console.log("📌 解析出的 Base URL:",c);const u=[...v.matchAll(/\d+/g)].map(p=>p[0]);if(u.length===0)return console.log("❌ 未找到数字部分，无法推算"),null;const f=u.at(-1),h=String(parseInt(f,10)+n).padStart(f.length,"0"),k=v.replace(f,h);let d=["png","jpg","webp"];d=d.filter(p=>p!==a),d.unshift(a),console.log(`📝 尝试格式顺序: ${d.join(" -> ")}`);for(let p of d){let w=`${c}${k}.${p}`;if(console.log(`🔄 尝试加载图片: ${w}`),await O(w))return console.log(`✅ 图片加载成功: ${w}`),w}return console.log("❌ 所有尝试都失败，未找到可用图片"),null},O=m=>new Promise(n=>{const o=new Image;o.src=m,o.onload=()=>n(!0),o.onerror=()=>n(!1)}),z={class:"comic-viewer"},D={class:"cover-wrapper"},P=["src"],Z={key:1,class:"input-container"},G={key:0,class:"extra-buttons"},H={class:"image-list"},K=["src","onError"],Q={key:1,class:"placeholder"},W={class:"floating-buttons"},X={class:"dropdown"},Y={key:0,class:"dropdown-menu"},ee={class:"dropdown"},te={key:0,class:"dropdown-menu"},oe={__name:"ComicViewer",setup(m){const n=g([]),o=g(""),v=g(""),a=g(!1),c=g(!1),u=g(!1),f=g(!1),h=q(),k=g({});V(()=>{h.query.id&&(console.log("获取参数:",h.query.id),u.value=!0,f.value=!0);const t=localStorage.getItem("lastComic");t&&(k.value=t),k.value&&(o.value=k.value,n.value.push(k.value)),document.addEventListener("click",d)}),F(()=>n.value.length,t=>{console.log("=============== imageUrls 长度变化:",t),t>10&&(f.value=!0)}),S(()=>{document.removeEventListener("click",d)});const d=t=>{if(t.target.tagName==="BUTTON"){const e=t.target;e.disabled=!0,setTimeout(()=>{e.disabled=!1},1e3)}},p=()=>{if(!o.value.trim()){alert("请输入有效的图片地址！");return}const t=new Image;t.src=o.value,t.onload=()=>{n.value=[],n.value.push(o.value),localStorage.setItem("lastComic",o.value)},t.onerror=()=>{alert("❌ 无法加载图片，请检查 URL 是否正确！")}},w=()=>{alert("📌 已收藏")},U=()=>{alert("👍 已点赞！")},x=()=>{alert("👎 已踩！")},E=()=>{alert("💬 进入评论区！")},_=async t=>{a.value=!1,c.value=!1;const e=n.value.at(-1);if(!e)return;const l=await I(e,t);l?n.value.push(l):console.log("❌ 无法加载下一张图片")},b=async t=>{a.value=!1,c.value=!1;const e=n.value.at(-1);if(!e)return;const l=await J(e,t);n.value.push(...l)},L=()=>{a.value=!a.value,c.value=!1},N=()=>{c.value=!c.value,a.value=!1},B=t=>{const e=n.value[t],l=M(e);l?n.value[t]=e.replace(/\.[^/.]+$/,l):(console.log(`❌ 图片加载失败: ${e}`),n.value[t]=null)},M=t=>{const e=[".png",".jpg",".webp"],l=t.match(/\.[^/.]+$/)[0];let C=e.indexOf(l);return C===-1?null:e[(C+1)%e.length]};return(t,e)=>(i(),r("div",z,[s("div",D,[v.value?(i(),r("img",{key:0,src:v.value,alt:"预览图片"},null,8,P)):(i(),r("div",Z,[T(s("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>o.value=l),type:"text",placeholder:"请输入图片地址",autocomplete:"off",spellcheck:"false"},null,512),[[j,o.value]]),s("button",{onClick:p},"预览"),f.value?(i(),r("button",{key:0,onClick:w},"⭐")):$("",!0)]))]),u.value?(i(),r("div",G,[s("button",{onClick:U},"👍"),s("button",{onClick:x},"👎"),s("button",{onClick:E},"💬")])):$("",!0),s("div",H,[(i(!0),r(y,null,A(n.value,(l,C)=>(i(),r(y,{key:C},[l?(i(),r("img",{key:0,src:l,onError:le=>B(C),alt:"漫画图片"},null,40,K)):(i(),r("div",Q,"❌ 加载失败"))],64))),128))]),s("div",W,[s("div",X,[s("button",{onClick:L},"加载"),a.value?(i(),r("ul",Y,[s("li",{onClick:e[1]||(e[1]=l=>b(10))},"加载 10"),s("li",{onClick:e[2]||(e[2]=l=>b(50))},"加载 50"),s("li",{onClick:e[3]||(e[3]=l=>b(100))},"加载 100")])):$("",!0)]),s("div",ee,[s("button",{onClick:N},"跳跃"),c.value?(i(),r("ul",te,[s("li",{onClick:e[4]||(e[4]=l=>_(-10))},"跳跃 -10"),s("li",{onClick:e[5]||(e[5]=l=>_(10))},"跳跃 10"),s("li",{onClick:e[6]||(e[6]=l=>_(50))},"跳跃 50"),s("li",{onClick:e[7]||(e[7]=l=>_(100))},"跳跃 100")])):$("",!0)])])]))}},se=R(oe,[["__scopeId","data-v-c0c27170"]]);export{se as default};
